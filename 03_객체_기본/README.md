# 03_객체_기본 (요약)

## 3.1 객체
- 객체는 연관배열(associative array)이다.
- 객체의 키(식별자)는 문자열이나 심볼만 허용됩니다.
- 프로퍼티 이름엔 제약이 없으나(문자열로 자동 형변환됨(예외: `__proto__`. 값을 할당해도 무시됨)), 점 표기법(`obj.prop`)은 키가 '유효한 변수 식별자’인 경우에만 사용할 수 있습니다.
- 여러 단어로 된 키나 계산된 프로퍼티는 대괄호 표기법(`obj['likes bird']`)으로 사용할 수 있습니다.
- 객체에는 특별한 정렬 방식이 있습니다. 정수 프로퍼티는 자동으로 정렬되고, 그 외의 프로퍼티는 객체에 추가한 순서 그대로 정렬됩니다. 
- 순수 객체(plain object) 외에도 Array, Date, Error 등 다양한 객체가 있으며, 객체를 확장한 것으로 독립적인 자료형이 아니라 객체형에 속합니다.


## 3.2 참조에 의한 객체 복사
- 객체는 참조에 의해 저장되고 복사됩니다.
- 객체간 대소비교나 객체를 원시값과 비교하면 객체가 원시형으로 변환됩니다 (대부분의 경우 코딩 실수).
- 객체를 복사하려면 프로퍼티를 순회해 하나씩 복사하거나, `Object.assign()`으로 얕은 복사(중첩 객체를 처리하지 못함)를 하거나, `_.cloneDeep(obj)`으로 깊은 복사를 합니다.


## 3.3 가비지 컬렉션
- 자바스크립트 엔진 내에선 가비지 컬렉터가 끊임없이 도달 불가능한 객체를 메모리에서 삭제합니다. 개발자가 억지로 실행하거나 막을 수 없습니다.
- 태생부터 도달 가능한 값 "루트"
  - 현재 함수의 지역 변수와 매개변수, 중첩 함수의 체인에 있는 함수에서 사용되는 변수와 매개변수, 전역 변수 등등
  - 명백한 이유 없이는 삭제되지 않습니다.
- 루트가 참조하는 값이나 체이닝으로 루트에서 참조할 수 있는 값은 도달 가능한 값이 됩니다.
- 가비지 컬렉션 기본 알고리즘은 'mark-and-sweep'이며, 엔진마다 이를 빠르게 하는 다양한 최적화 기법을 적용합니다.


## 3.4 메서드와 this
- 객체 프로퍼티에 할당된 함수를 메서드라고 합니다.
- 메서드 내부에서 `this` 키워드로 객체를 참조할 수 있습니다. (`this`를 사용하지 않고 외부 변수를 참조해 접근하는 것도 가능하지만, 객체를 덮어씌우면 에러 가능성이 있음!)
- 대부분의 언어에서 `this`는 'bound this'로, 항상 메서드가 정의된 객체를 참조합니다. 자바스크립트의 `this` 값은 런타임에 결정되며, 함수 호출 전까진 값이 할당되지 않습니다.
- Arnav Aggrawal의 규칙 참고. 화살표 함수는 예외적으로 호출 시점과 상관없이 생성된(defined) 시점에 외부 일반 함수에서 `this` 값을 가져옵니다.
- 모든 함수에 this를 사용할 수 있습니다.


## 3.5 new 연산자와 생성자 함수
- 생성자 함수(생성자)는 사실 일반 함수입니다. 관례적으로 함수 이름 첫 글자를 대문자로 쓰고, 반드시 `new` 연산자와 함께 호출한다는 차이가 있을 뿐이죠.
- 빈 객체를 만들어 `this`에 할당하고, 함수를 실행한 후, this를 자동으로 반환합니다.  
  return 문이 있는 경우, 객체를 리턴한다면 `this` 대신 객체가 반환되고, 원시형을 리턴한다면 무시됩니다.
- `new.target`으로 함수가 `new`와 함께 호출되었는지 알 수 있습니다. 이 경우, 함수 자체를 반환해줍니다.


## 3.6 옵셔널 체이닝 '?.'
- 전엔 `&&`를 사용했습니다.
- `?.`는 왼쪽이 `null / undefined`면 평가를 멈춘 후 `undefined`를 반환합니다 (단락 평가, short-circuit).
- `?.`는 연산자가 아니라 문법 구조체(syntax construct)입니다. 세 가지 형태로 사용할 수 있습니다.
  1) `obj?.prop` – obj가 존재하면 obj.prop을 반환하고, 그렇지 않으면 undefined를 반환함  
  2) `obj?.[prop]` – obj가 존재하면 obj[prop]을 반환하고, 그렇지 않으면 undefined를 반환함  
  3) `obj?.method()` – obj가 존재하면 obj.method()를 호출하고, 그렇지 않으면 undefined를 반환함
- 읽기나 삭제(`delete` 사용)에는 사용할 수 있지만 쓰기에는 사용할 수 없습니다.
- 새로 추가된 문법이라 구식 브라우저는 폴리필이 필요합니다.


## 3.7 심볼형
- Symbol은 원시형 데이터로, 유일무이한 식별자를 만드는 데 사용됩니다. `let 심볼 = Symbol("심볼이름=설명")`
- 심볼은 이름(설명)이 같더라도 값이 항상 다릅니다. 이름이 같을 때 값도 같길 원한다면 전역 심볼 레지스트리를 사용해야 합니다. `let 심볼 = Symbol.for("이름")`
- 심볼형은 '언어 차원의 보호장치'때문에 문자형 등으로 자동 형변환 되지 않습니다.   
  굳이 출력하려면 `.toString()`이나 `description` 프로퍼티를 사용합니다.
- 외부 코드에서 접근이 불가능하고 값도 덮어쓸 수 없는 ‘숨김’ 프로퍼티를 만들 수 있습니다.  
  특히 서드파티 코드에 속한 객체에 새로운 프로퍼티를 안전하게 추가하고 싶을 때 유용합니다.
- 객체 리터럴을 사용해 객체를 만든 경우, 심볼형 키를 만드려면 대괄호를 사용합니다.
- 외부 스크립트에서 접근하지 못하도록 하는 '심볼형 프로퍼티 숨기기' 원칙으로 `for .. in`과 `Object.keys()`에서 배제되지만, `Object.assign`에선 복사됩니다.
- 자바스크립트 내부에서 사용되는 시스템 심볼은 `Symbol.*`로 접근할 수 있고, 이를 사용해 내장 메서드 등의 기본 동작을 입맛대로 변경할 수 있습니다.


## 3.8 객체를 원시형으로 변환하기
- 원시값을 기대하는 내장 함수나 연산자를 사용할 때 객체는 자동으로 원시형으로 형 변환됩니다(예: `+`, `alert()`).
- 논리 평가시 언제나 `true`입니다.
- 형 변환은 'hint'(목표로 하는 자료형)를 기준으로 세 종류로 구분할 수 있습니다.
  1) "string" (alert 같이 문자열을 필요로 하는 연산)
  2) "number" (수학 연산)
  3) "default"
- `default`는 연산자가 기대하는 피연산자를 '확신할 수 없을 때’입니다. 아주 드물게 발생합니다.  
  `Date`를 제외한 모든 내장 객체는 "default"와 "number"일 때를 동일하게 처리합니다. 
- 형 변환엔 다음 알고리즘이 적용됩니다.
  1) 객체에 `obj[Symbol.toPrimitive](hint)`메서드가 있는지 찾고, 있다면 호출합니다.
  2) 1에 해당하지 않고 hint가 "string"이라면, `obj.toString()`을, 없다면 `obj.valueOf()`를 호출합니다.
  3) 1과 2에 해당하지 않고, hint가 "number"나 "default"라면, `obj.valueOf()`를, 없다면 `obj.toString()`을 호출합니다.
- `toString`과 `valueOf`의 실행규칙:  
  hint에 명시된 자료형으로의 형변환을 보장하진 않지만, 반드시 원시값을 반환합니다.

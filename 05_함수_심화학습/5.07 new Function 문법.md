```
📍 [요약]
- new Function을 이용해 만든 함수의 [[Environment]]는 외부 렉시컬 환경이 아닌 전역 렉시컬 환경을 참조하므로 외부 변수를 사용할 수 없습니다. 
- 단점 같아 보이는 특징이긴 하지만 에러를 예방해 준다는 관점에선 장점이 되기도 합니다. 
- 구조상으론 매개변수를 사용해 값을 받는 게 더 낫습니다. 압축기에 의한 에러도 방지할 수 있죠.
```
<br/>

함수를 만드는 또 다른 방법 `new Function`
<br/>

# 문법
```js
let func = new Function ([arg1, arg2, ...argN], functionBody);
let sum = new Function('a', 'b', 'return a + b'); 
```
기존에 사용하던 방법과 `new Function`을 사용해 함수를 만드는 방법의 가장 큰 차이는 런타임에 받은 문자열을 사용해 함수를 만들 수 있다는 점입니다.
서버에서 코드를 받거나 템플릿을 사용해 함수를 동적으로 컴파일해야 하는 경우, 복잡한 웹 애플리케이션을 구현할 때와 같이 아주 특별한 경우에 `new Function`을 사용할 수 있습니다.

<br/><br/>

# 클로저
`new Function`을 이용해 함수를 만들면 함수의 `[[Environment]]` 프로퍼티가 현재 렉시컬 환경이 아닌 **전역 렉시컬 환경을 참조**하게 됩니다.

따라서 `new Function`을 이용해 만든 함수는 외부 변수에 접근할 수 없고, 오직 전역 변수에만 접근할 수 있습니다.
```js
function getFunc() {
  let value = "test";
  let func = new Function('alert(value)');
  return func;
}

getFunc()(); // ReferenceError: value is not defined
```

스크립트를 작성하는 시점엔 어떻게 함수를 짤지 알 수 없어서 기존의 함수 선언 방법은 사용하지 못하는데, 스크립트 실행 시점 즈음엔 함수를 어떻게 짜야 할 지 아이디어가 떠오를 수 있을 겁니다. 
이때, 서버를 비롯한 외부 출처를 통해 코드를 받아올 수 있습니다.  

이렇게 `new Function`으로 만든 새 함수는 기존 스크립트와 문제없이 상호작용할 수 있어야 합니다.  
그런데 만일 함수 내에서 외부 변수에 접근한다면 어떤 문제가 생길 수 있을까요?  

스크립트는 프로덕션 서버에 반영되기 전, ***압축기(minifier)*** 에 의해 압축됩니다.  
압축기는 스크립트에서 주석이나 여분의 공백 등을 없애 코드 크기를 줄여주는 특수한 프로그램으로, 지역 변수의 이름을 짧게 바꾸는 작업도 합니다.  
예를 들어, 함수 내부에 `let userName`라는 변수는 `let a` 등 짧은 이름으로 대체됩니다.    
(함수 외부에선 지역 변수에 접근할 수 없고, 함수 내부에서 해당 변수가 등장하는 모든 곳의 이름을 바꿔주기 때문에 이는 보통 안전합니다.
또한 압축기는 영리해서, 단순히 문자열을 찾아서 바꾸는 것이 아니라 코드 구조를 분석해 기존 코드 기능을 망가뜨리지 않습니다.)

이는 `new Function`으로 만들어진 함수에서 외부 변수에 접근할 때 문제를 발생시킵니다.  
압축기가 동작한 이후에 생성된 `new Function` 함수에서 외부 변수 `userName`에 접근한다면, `userName`은 이미 이름이 변경되었기 때문에 찾을 수 없게 됩니다.
이런 실수를 예방하기 위해 `new Function`은 전역 렉시컬 환경을 참조합니다.  

함수 내부에서 외부 변수에 접근하는 것은 아키텍처 관점에서도 좋지 않고 에러에 취약합니다.
`new Function`으로 만든 함수에 무언갈 넘겨주고 싶다면 인수를 사용하세요.

<br/><br/><br/>


출처: https://ko.javascript.info/new-function
